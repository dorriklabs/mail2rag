# ============================================================================
# MAIL2RAG3 - Environment Variables
# ============================================================================

# ============================================================================
# EMAIL (IMAP / SMTP)
# ============================================================================

# IMAP (réception des emails)
IMAP_SERVER=imap.example.com
IMAP_PORT=993
IMAP_USER=rag@example.com
IMAP_PASSWORD=CHANGE_ME
IMAP_TIMEOUT=30

# SMTP (envoi des réponses)
SMTP_SERVER=smtp.example.com
SMTP_PORT=587
SMTP_USER=rag@example.com
SMTP_PASSWORD=CHANGE_ME
SMTP_TIMEOUT=30

IMAP_POLL_INTERVAL=60

# ============================================================================
# LM STUDIO / VISION AI
# ============================================================================

# LLM Chat / Vision (LM Studio local)
AI_API_URL=http://host.docker.internal:1234/v1/chat/completions
AI_API_KEY=lm-studio
AI_MODEL_NAME=qwen/qwen3-vl-8b

# Embedding model
EMBEDDING_MODEL_PREF=text-embedding-bge-m3

VISION_ENABLE=true
VISION_TEMPERATURE=0.0
VISION_MAX_TOKENS=1500
VISION_TIMEOUT=90

# ============================================================================
# TIKA (DOCUMENT TEXT EXTRACTION)
# ============================================================================

TIKA_SERVER_URL=http://tika:9998
TIKA_TIMEOUT=60
TIKA_ENABLE=true
TIKA_FALLBACK_TO_VISION=true

# ============================================================================
# PROMPTS
# ============================================================================

PROMPTS_DIR=/etc/mail2rag/prompts
VISION_AI_PROMPT_FILE=vision_ai.txt
SUPPORT_QA_PROMPT_FILE=support_qa_prompt.txt

# ============================================================================
# CHEMINS / ARCHIVE / ROUTING
# ============================================================================

STATE_PATH=/var/lib/mail2rag/state.json
ARCHIVE_PATH=/var/lib/mail2rag/mail2rag_archive
ROUTING_PATH=/etc/mail2rag/routing.json

ARCHIVE_BASE_URL=http://localhost:8080

# ============================================================================
# LOGGING
# ============================================================================

LOG_LEVEL=INFO
# 10 MB
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=5

LOG_TRUNCATE_HEAD=5
LOG_TRUNCATE_TAIL=3
LOG_MAX_LINE_LENGTH=500

# ============================================================================
# DEFAULTS / LIMITES / FILTRAGE
# ============================================================================

DEFAULT_WORKSPACE=default-workspace
DEFAULT_SUBJECT=No_Subject
MAX_FILENAME_LENGTH=100

# Extensions autorisées
ALLOWED_EXTENSIONS=.pdf,.docx,.doc,.txt,.md,.csv,.xlsx,.xls,.pptx,.ppt,.html,.xml,.json,.jpg,.jpeg,.png,.bmp,.webp

# Extensions bloquées
BLOCKED_EXTENSIONS=.exe,.bin,.bat,.sh,.zip,.rar,.7z,.tar,.gz,.iso,.dll

# Taille min image (KB) pour éviter les logos / signatures
MIN_IMAGE_SIZE_KB=5

# OCR
MAX_OCR_PAGES=10
OCR_DPI=300

# ============================================================================
# LLM SETTINGS (RÉPONSES)
# ============================================================================

DEFAULT_LLM_TEMPERATURE=0.1
DEFAULT_REFUSAL_RESPONSE=Je ne trouve pas d information pertinente dans vos documents pour répondre à cette question.

# ============================================================================
# WORKERS / CONCURRENCE
# ============================================================================

WORKER_COUNT=1
WORKER_QUEUE_SIZE=50

# ============================================================================
# EMAIL SUMMARY (RÉSUMÉS D’INGESTION)
# ============================================================================

ENABLE_EMAIL_SUMMARY=false
SUMMARY_MAX_SENTENCES=3
SUMMARY_MAX_TOKENS=150

# ============================================================================
# SUPPORT QA (réécriture Q/R)
# ============================================================================

SUPPORT_QA_TEMPERATURE=0.1
SUPPORT_QA_MAX_TOKENS=1200

# ============================================================================
# RAG PROXY / HYBRID SEARCH
# ============================================================================

RAG_PROXY_URL=http://rag_proxy:8000
USE_RAG_PROXY_FOR_SEARCH=true

AUTO_REBUILD_BM25=true

VECTOR_DB_HOST=qdrant
VECTOR_DB_PORT=6333
VECTOR_DB_COLLECTION=documents

# ============================================================================
# MAINTENANCE / SYNC
# ============================================================================

# Nettoyer l'archive avant la synchronisation au démarrage
CLEANUP_ARCHIVE_BEFORE_SYNC=false

# Synchroniser l'archive au démarrage
SYNC_ON_START=true

# ============================================================================
# CHAT HISTORY
# ============================================================================

# Sauvegarder l'historique de chat dans l'archive (log seulement, non indexé)
SAVE_CHAT_HISTORY=true

# ============================================================================
# CHUNKING INTELLIGENT
# ============================================================================
CHUNK_SIZE=800
CHUNK_OVERLAP=100
CHUNKING_STRATEGY=recursive
